# EchoMind – 데이터 파싱 과정과 main.py 아웃풋 설계 이유

---

## 1. 데이터 파싱의 목적

`main.py`의 파싱 목적은 다음 한 문장으로 요약됩니다.

> **카카오톡 대화 로그를 ‘사람의 성격’이 아니라  
> ‘반복적으로 관찰되는 대화 행동 패턴’으로 변환한다.**

따라서 파싱 단계에서는:
- 의미 해석 ❌
- 감정 추론 ❌
- 성격 분류 ❌

를 의도적으로 배제하고,

- 누가
- 언제
- 어떤 형태로 말했는지

라는 **객관적으로 관찰 가능한 정보만** 남깁니다.

---

## 2. 전체 데이터 파싱 과정 개요

```text
KakaoTalk TXT
 ├─ 1. 라인 단위 입력
 ├─ 2. 메시지 패턴 인식 (정규식)
 ├─ 3. 시스템 메시지 제거
 ├─ 4. 텍스트 정제 (노이즈 제거)
 ├─ 5. 개인정보 마스킹
 ├─ 6. 사용자 발화 필터링
 ├─ 7. 파싱 품질 기록
 └─ 8. 대화 행동 지표 계산
````

---

## 3. 단계별 파싱 과정 설명

### 3.1 TXT를 라인 단위로 읽는 이유

* 카카오톡 내보내기 TXT는 기본적으로
  **“한 줄 = 한 메시지” 구조**를 가짐
* 라인 단위 처리는:

  * 구현이 단순
  * 오류 지점 추적이 쉬움
  * 실패한 줄을 그대로 기록 가능


---

### 3.2 메시지 구조 인식 (정규식)

지원하는 대표적인 카카오톡 포맷:

* `[이름] [시간] 메시지`
* `시간, 이름 : 메시지`

이 단계에서 추출하는 최소 정보:

* `speaker` : 발화자
* `time` : 발화 시각(문자열)
* `text` : 메시지 내용

이유

* 이 3가지만 있으면 모든 후속 지표 계산 가능
* 추가 정보(방 이름, 날짜 헤더 등)는 매칭에 불필요

---

### 3.3 시스템 메시지 제거

제거 대상 예시:

* “사진을 보냈습니다”
* “이모티콘을 보냈습니다”
* “송금”
* “삭제된 메시지입니다”


---

### 3.4 텍스트 정제 (Cleaning)

수행 작업:

* URL 제거
* 반복 웃음/울음(`ㅋㅋㅋ`, `ㅠㅠㅠ`) 제거
* 공백 정리



---

### 3.5 개인정보 마스킹 (PII)

마스킹 대상:

* 전화번호
* 이메일
* 주민번호 형태

이유

* 원문 유출 방지
* JSON 로그/DB 저장 시 보안 확보
* 매칭에는 전혀 필요 없는 정보

---

### 3.6 특정 사용자 발화만 추출

* 업로드한 사용자 1명 기준 분석
* 상대방의 발화는 섞지 않음

이유

* “내가 어떤 사람인가”를 독립적으로 표현하기 위함
* 상대에 따라 달라지는 말투 영향을 제거

---

### 3.7 파싱 품질 기록 (`parse_quality`)

다음 항목을 모두 기록:

* 전체 줄 수
* 파싱 성공 줄 수
* 파싱 실패 줄 수
* 시스템 메시지 제거 수
* 정제 후 빈 텍스트 수

이유

* 매칭 결과의 **신뢰도(confidence)** 산출 근거
* “왜 이 결과를 덜 믿는지”를 설명 가능하게 하기 위함

---

## 4. main.py 아웃풋 구조

### 4.1 최종 아웃풋 예시

```json
{
  "user_id": "u_123",
  "message_count": 670,
  "confidence": 0.8,
  "rhythm": {
    "avg_msg_len": 11.7,
    "question_ratio": 0.076,
    "avg_gap_sec": null
  },
  "language": {
    "honorific_ratio": 0.087,
    "casual_ratio": 0.049,
    "emoji_ratio": 0.004,
    "hedge_ratio": 0.16
  }
}
```

---

## 5. 왜 이런 아웃풋을 선택했는가

### 5.1 성격이 아닌 “대화 행동 벡터”를 선택한 이유

* 성격 추론은:

  * 상황 의존적
  * 주관적
  * 검증 어려움
* 반면 대화 행동은:

  * 실제 텍스트에서 관찰 가능
  * 반복 측정 가능
  * 수치화·비교 가능

 결론

“사람이 어떤 성격인가”가 아니라
 “사람이 평소 어떻게 말해왔는가”를 매칭 기준으로 삼는다.

---

### 5.2 Rhythm 지표 선정 이유

| 지표        | 이유            |
| --------- | ------------- |
| 평균 메시지 길이 | 장문형/단문형 대화 성향 |
| 질문 비율     | 대화 주도 방식      |
| 응답 간격     | 대화 템포(가능할 때만) |

→ **대화가 자연스럽게 이어질 가능성**을 가장 잘 설명

---

### 5.3 Language 지표 선정 이유

| 지표       | 이유        |
| -------- | --------- |
| 존댓말 비율   | 심리적 거리감   |
| 반말 비율    | 친밀도 표현 방식 |
| 이모지 비율   | 감정 표현 스타일 |
| 완곡 표현 비율 | 배려·직설성 정도 |

→ **대화에서 느껴지는 부담감/편안함**을 수치로 표현

---

### 5.4 confidence를 별도로 둔 이유

confidence는 다음 질문에 대한 답입니다.

> “이 사용자의 데이터로 계산한 지표를
> 매칭에 얼마나 신뢰하고 반영해도 되는가?”

사용 근거:

* 메시지 수
* 파싱 성공률
* 핵심 지표 누락 여부

 이유

* 데이터가 적거나 불완전한 사용자가
  매칭 결과를 과도하게 흔드는 것을 방지

---

## 6. 의도적으로 포함하지 않은 항목들

* 성격 점수
* 공감 점수
* 감정 점수
* 톤 점수
* MBTI 유사 벡터

 이유

* 근거 제시 어려움
* 재현성 부족
* 설명 불가능

이들은 **설명용(LLM)** 으로만 사용 가능

---

## 7. 한 문장 요약

> **EchoMind의 main.py는
> 카카오톡 TXT를 성격 추정이 아닌,
> 검증 가능한 ‘대화 행동 벡터’로 변환하기 위한 파서다.**
