{% extends "base.html" %}

{% block title %}ë¶„ì„ íˆìŠ¤í† ë¦¬{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <div class="text-center mb-12">
        <h1 class="text-3xl font-extrabold text-slate-900">ë¶„ì„ íˆìŠ¤í† ë¦¬</h1>
        <p class="mt-4 text-slate-500">
            ê³¼ê±°ì— ë¶„ì„í–ˆë˜ ì„±í–¥ ë¦¬í¬íŠ¸ ëª©ë¡ì…ë‹ˆë‹¤.<br>
            ì–¸ì œë“ ì§€ ë‹¤ì‹œ ì—´ëŒí•˜ê±°ë‚˜, ëŒ€í‘œ í”„ë¡œí•„ë¡œ ì„¤ì •í•˜ì—¬ ë§¤ì¹­ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </div>

    <!-- Sticky Active Profile Header -->
    {% if active_result %}
    <div
        class="sticky top-20 z-40 mb-10 backdrop-blur-md bg-white/95 p-6 rounded-2xl border-2 border-indigo-500 shadow-2xl ring-4 ring-indigo-50/50 transition-all duration-300">
        <div class="flex items-center justify-between mb-4 border-b border-indigo-100 pb-3">
            <h2 class="text-indigo-900 font-bold text-lg flex items-center gap-2">
                <span class="text-2xl">ğŸ‘‘</span> í˜„ì¬ ëŒ€í‘œ í”„ë¡œí•„
            </h2>
            <a href="{{ url_for('view_result', result_id=active_result.result_id) }}"
                class="px-5 py-2 rounded-lg text-sm font-bold bg-indigo-600 text-white hover:bg-indigo-700 shadow-md transition-all hover:scale-105 active:scale-95">
                ìƒì„¸ ë³´ê¸°
            </a>
        </div>

        <div class="flex flex-col md:flex-row gap-6 items-start">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-3xl font-black text-indigo-700 tracking-tight">{{ active_result.mbti_prediction
                        }}</span>
                    <span
                        class="px-2.5 py-0.5 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-full border border-indigo-200">
                        {{ active_result.full_report_json.meta.speaker_name if active_result.full_report_json and
                        active_result.full_report_json.meta else "ì•Œ ìˆ˜ ì—†ìŒ" }}
                    </span>
                    <span class="text-xs text-slate-400 font-mono">{{ active_result.created_at.strftime('%Y-%m-%d')
                        }}</span>
                </div>
                <p class="text-slate-600 text-sm leading-relaxed line-clamp-2">
                    {{ active_result.summary_text }}
                </p>
            </div>

            <!-- Quick Stats -->
            <div class="flex gap-3 text-center bg-indigo-50/50 p-3 rounded-xl border border-indigo-100">
                <div>
                    <div class="text-lg font-bold text-slate-700">{{ active_result.openness | int }}</div>
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Open</div>
                </div>
                <div class="w-px bg-indigo-200"></div>
                <div>
                    <div class="text-lg font-bold text-slate-700">{{ active_result.conscientiousness | int }}</div>
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Cons</div>
                </div>
                <div class="w-px bg-indigo-200"></div>
                <div>
                    <div class="text-lg font-bold text-slate-700">{{ active_result.extraversion | int }}</div>
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Extr</div>
                </div>
                <div class="w-px bg-indigo-200"></div>
                <div>
                    <div class="text-lg font-bold text-slate-700">{{ active_result.agreeableness | int }}</div>
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Agre</div>
                </div>
                <div class="w-px bg-indigo-200"></div>
                <div>
                    <div class="text-lg font-bold text-slate-700">{{ active_result.neuroticism | int }}</div>
                    <div class="text-[10px] text-slate-400 uppercase font-bold">Neur</div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if results %}
    <div class="space-y-4">
        {% for res in results %}
        <div
            class="glass-panel p-6 rounded-xl flex flex-col md:flex-row items-center justify-between gap-4 hover:shadow-md transition-all duration-200">
            <!-- Info -->
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-xs font-mono text-slate-400">{{ res.created_at.strftime('%Y-%m-%d %H:%M')
                        }}</span>
                    {% if res.is_representative %}
                    <span
                        class="px-2 py-0.5 rounded-full text-[10px] font-bold bg-indigo-100 text-indigo-700 uppercase tracking-widest border border-indigo-200 shadow-sm">
                        ACTIVE PROFILE
                    </span>
                    {% endif %}
                </div>
                <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                    {{ res.full_report_json.meta.speaker_name if res.full_report_json and res.full_report_json.meta else
                    "ì•Œ ìˆ˜ ì—†ìŒ" }}
                    <span class="text-sm font-normal text-slate-500">({{ res.mbti_prediction }})</span>
                </h3>
                <p class="text-sm text-slate-600 mt-1 line-clamp-1">
                    {{ res.summary_text }}
                </p>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3">
                <a href="{{ url_for('view_result', result_id=res.result_id) }}"
                    class="px-4 py-2 rounded-lg text-sm font-medium bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-indigo-600 transition-colors">
                    ìƒì„¸ ë³´ê¸°
                </a>

                {% if not res.is_representative %}
                <form action="{{ url_for('set_representative', result_id=res.result_id) }}" method="POST">
                    <button type="submit"
                        class="px-4 py-2 rounded-lg text-sm font-medium bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-colors"
                        title="ì´ ê²°ê³¼ë¥¼ ë§¤ì¹­ìš© ëŒ€í‘œ í”„ë¡œí•„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤">
                        ëŒ€í‘œ ì„¤ì •
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-20 bg-white/50 rounded-2xl border border-slate-100">
        <div class="text-6xl mb-6">ğŸ“‚</div>
        <p class="text-xl font-medium text-slate-600 mb-2">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <p class="text-slate-400">ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ ì—…ë¡œë“œí•˜ì—¬ ì„±í–¥ì„ ë¶„ì„í•´ë³´ì„¸ìš”.</p>
        <a href="{{ url_for('upload_page') }}"
            class="inline-block mt-6 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">
            ìƒˆ ë¶„ì„ ì‹œì‘í•˜ê¸°
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}