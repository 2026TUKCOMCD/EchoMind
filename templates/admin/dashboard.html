{% extends "base.html" %}

{% block title %}관리자 대시보드{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-10">
        <div>
            <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white flex items-center gap-3">
                <span>🎛️</span> 관리자 대시보드
            </h1>
            <p class="mt-1 text-slate-500 dark:text-slate-400">시스템 모니터링 및 매칭 알고리즘 튜닝</p>
            <!-- Debug Info -->
            <div class="mt-2 p-2 bg-slate-100 dark:bg-slate-800 text-xs text-slate-500 dark:text-slate-400 rounded">
                Data Check: {{ stats.total_users }} users / {{ stats.total_results }} results
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800 border border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800/50">
                💻System Active
            </span>
            <a href="{{ url_for('admin_logout') }}"
                class="text-sm font-medium text-slate-500 hover:text-red-600 transition-colors">
                로그아웃
            </a>
        </div>
    </div>

    <!-- Tabs Navigation & Content Shell -->
    <div x-data="dashboardApp" class="space-y-6" x-effect="console.log('ROOT activeTab changed:', activeTab)">

        <!-- Tab Headers -->
        <div class="border-b border-slate-200 dark:border-slate-700">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs" class="scrollbar-hide overflow-x-auto">
                <button @click="activeTab = 'dashboard'; window.refreshCharts && window.refreshCharts()"
                    :class="{ 'border-indigo-500 text-indigo-600 dark:text-indigo-400': activeTab === 'dashboard', 'border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600': activeTab !== 'dashboard' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors">
                    📊 통계 (Dashboard)
                </button>
                <button @click="activeTab = 'users'; $dispatch('refresh-users')"
                    :class="{ 'border-indigo-500 text-indigo-600 dark:text-indigo-400': activeTab === 'users', 'border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600': activeTab !== 'users' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors">
                    👥 사용자 관리 (Users)
                </button>
                <button @click="activeTab = 'logs'"
                    :class="{ 'border-indigo-500 text-indigo-600 dark:text-indigo-400': activeTab === 'logs', 'border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600': activeTab !== 'logs' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors">
                    📜 매칭 로그 (Logs)
                </button>
                <button @click="activeTab = 'matching'"
                    :class="{ 'border-indigo-500 text-indigo-600 dark:text-indigo-400': activeTab === 'matching', 'border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600': activeTab !== 'matching' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors">
                    🧪 매칭 시뮬레이션 (Simulation)
                </button>
                <button @click="console.log('Clicked System Button'); activeTab = 'system'"
                    :class="{ 'border-indigo-500 text-indigo-600 dark:text-indigo-400': activeTab === 'system', 'border-transparent text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:border-slate-300 dark:hover:border-slate-600': activeTab !== 'system' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors">
                    ⚙️ 시스템 관리 (System)
                </button>
            </nav>
        </div>

        <!-- Tab Contents -->
        <div class="h-full">
            {% include 'admin/tabs/tab_statistics_content.html' %}
            {% include 'admin/tabs/tab_users_content.html' %}
            {% include 'admin/tabs/tab_logs_content.html' %}
            {% include 'admin/tabs/tab_matching_content.html' %}
            {% include 'admin/tabs/tab_system_content.html' %}

            <!-- Modals -->
            {% include 'admin/modals/modal_file_viewer.html' %}
            {% include 'admin/modals/modal_personality_viewer.html' %}
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="//unpkg.com/alpinejs" defer></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- External Custom JS -->
<script src="{{ url_for('static', filename='js/admin/dashboard_app.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin/users_tab.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin/matching_tab.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin/system_tab.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin/charts_config.js') }}"></script>

<script>
    // Initialize Charts with server data
    const serverStatsData = JSON.parse('{{ chart_data | tojson | safe }}');
    document.addEventListener('DOMContentLoaded', () => {
        if (window.initCharts) window.initCharts(serverStatsData);
    });
</script>
{% endblock %}