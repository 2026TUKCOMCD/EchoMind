<!-- 4. Matching Tab -->
<div x-show="activeTab === 'matching'" style="display: none;" x-data="dummyManager" x-init="init()">

    <div class="space-y-6">

        <!-- 1. ÏÇ¨Ïö©Ïûê Îß§Ïπ≠ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Top) -->
        <!-- ÌÜµÌï© ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏÑπÏÖò -->
        <div class="mt-4 pt-4">
            <div class="flex items-center gap-2 mb-4">
                <h3 class="font-bold text-lg text-slate-800">üß™ ÏÇ¨Ïö©Ïûê Îß§Ïπ≠ ÏãúÎÆ¨Î†àÏù¥ÏÖò</h3>
                <span class="text-sm text-slate-500 font-normal">ÏÑ†ÌÉùÎêú ÏÇ¨Ïö©Ïûê(2Î™Ö)Ïùò Îß§Ïπ≠ Ï†êÏàòÎ•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í≥ÑÏÇ∞Ìï©ÎãàÎã§.</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- ÏôºÏ™Ω: ÏãúÎÆ¨Î†àÏù¥ÏÖò Ïª®Ìä∏Î°§ Ìå®ÎÑê (Unified) -->
                <div class="bg-indigo-50 p-6 rounded-2xl border border-indigo-100">
                    <h4 class="font-bold text-base text-indigo-700 mb-4 flex items-center gap-2">
                        <span>üé≤ ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏÑ§Ï†ï</span>
                        <span
                            class="text-xs bg-white text-indigo-600 px-2 py-0.5 rounded-full font-bold border border-indigo-200">Real-time</span>
                    </h4>

                    <!-- ÏÑ†ÌÉùÎêú ÏÇ¨Ïö©Ïûê ÌëúÏãú -->
                    <div class="bg-white p-4 rounded-xl shadow-sm mb-6 border border-indigo-50">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">Selected
                                Users</span>
                            <span class="text-xs text-indigo-500 font-bold"
                                x-show="selectedIds.length === 2">Ready</span>
                        </div>
                        <div class="space-y-2">
                            <!-- User A -->
                            <div class="flex items-center gap-2 p-2 bg-slate-50 rounded-lg border border-slate-100">
                                <div
                                    class="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xs font-bold">
                                    A</div>
                                <input type="text" :value="getSelectedName(0)" readonly placeholder="ÏÇ¨Ïö©Ïûê A ÏÑ†ÌÉù (Î™©Î°ùÏóêÏÑú ÌÅ¥Î¶≠)"
                                    class="bg-transparent border-none text-sm font-bold text-slate-700 w-full focus:ring-0 p-0">
                                <button @click="removeFromSimulation(selectedIds[0])" x-show="selectedIds.length > 0"
                                    class="text-slate-400 hover:text-red-500">&times;</button>
                            </div>
                            <!-- User B -->
                            <div class="flex items-center gap-2 p-2 bg-slate-50 rounded-lg border border-slate-100">
                                <div
                                    class="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-xs font-bold">
                                    B</div>
                                <input type="text" :value="getSelectedName(1)" readonly placeholder="ÏÇ¨Ïö©Ïûê B ÏÑ†ÌÉù (Î™©Î°ùÏóêÏÑú ÌÅ¥Î¶≠)"
                                    class="bg-transparent border-none text-sm font-bold text-slate-700 w-full focus:ring-0 p-0">
                                <button @click="removeFromSimulation(selectedIds[1])" x-show="selectedIds.length > 1"
                                    class="text-slate-400 hover:text-red-500">&times;</button>
                            </div>
                        </div>

                        <!-- ÏßÅÏ†ë ÏûÖÎ†• (ÏòµÏÖò) -->
                        <div class="mt-3 flex gap-2">
                            <input type="number" placeholder="ID ÏßÅÏ†ë ÏûÖÎ†•"
                                class="w-full text-xs px-2 py-1 rounded border-slate-200 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                            <button
                                @click="addToSimulation($event.target.previousElementSibling.value); $event.target.previousElementSibling.value = ''"
                                class="px-3 py-1 bg-slate-200 hover:bg-slate-300 text-slate-600 rounded-lg text-xs font-bold transition-colors">
                                Ï∂îÍ∞Ä
                            </button>
                        </div>
                    </div>

                    <!-- Í∞ÄÏ§ëÏπò Ï°∞Ï†à Ïä¨ÎùºÏù¥Îçî -->
                    <div class="space-y-4 mb-6">
                        <div class="border-b pb-3 mb-4 space-y-3">
                            <label class="font-bold text-base text-slate-800 block">Îß§Ïπ≠ Í∞ÄÏ§ëÏπò ÏÑ§Ï†ï (Ìï©Í≥Ñ
                                1.0)</label>
                            <button @click="resetWeights()"
                                class="w-full py-3 bg-white border-2 border-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-50 hover:border-slate-300 hover:text-indigo-600 transition-all shadow-sm flex items-center justify-center gap-2 text-sm">
                                <span class="text-lg">üîÑ</span> Í∞ÄÏ§ëÏπò Ï¥àÍ∏∞Ìôî
                            </button>
                        </div>

                        <!-- Similarity -->
                        <div>
                            <div class="flex justify-between text-xs mb-1 items-center">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-slate-600">Similarity</span>
                                    <button @click="locked.sim = !locked.sim"
                                        class="focus:outline-none transition-colors"
                                        :class="locked.sim ? 'text-indigo-600' : 'text-slate-300'">
                                        <span x-show="locked.sim">üîí</span>
                                        <span x-show="!locked.sim">üîì</span>
                                    </button>
                                </div>
                                <span x-text="dummyWeights.sim.toFixed(2)"
                                    class="font-mono font-bold text-indigo-600"></span>
                            </div>
                            <input type="range" min="0" max="1" step="0.01" x-model.number="dummyWeights.sim"
                                @input="adjustDummyWeights('sim')" :disabled="locked.sim"
                                class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer hover:bg-indigo-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        </div>

                        <!-- Chemistry -->
                        <div>
                            <div class="flex justify-between text-xs mb-1 items-center">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-slate-600">Chemistry</span>
                                    <button @click="locked.chem = !locked.chem"
                                        class="focus:outline-none transition-colors"
                                        :class="locked.chem ? 'text-indigo-600' : 'text-slate-300'">
                                        <span x-show="locked.chem">üîí</span>
                                        <span x-show="!locked.chem">üîì</span>
                                    </button>
                                </div>
                                <span x-text="dummyWeights.chem.toFixed(2)"
                                    class="font-mono font-bold text-rose-600"></span>
                            </div>
                            <input type="range" min="0" max="1" step="0.01" x-model.number="dummyWeights.chem"
                                @input="adjustDummyWeights('chem')" :disabled="locked.chem"
                                class="w-full h-2 bg-rose-200 rounded-lg appearance-none cursor-pointer hover:bg-rose-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        </div>

                        <!-- Activity -->
                        <div>
                            <div class="flex justify-between text-xs mb-1 items-center">
                                <div class="flex items-center gap-2">
                                    <span class="font-medium text-slate-600">Activity</span>
                                    <button @click="locked.act = !locked.act"
                                        class="focus:outline-none transition-colors"
                                        :class="locked.act ? 'text-indigo-600' : 'text-slate-300'">
                                        <span x-show="locked.act">üîí</span>
                                        <span x-show="!locked.act">üîì</span>
                                    </button>
                                </div>
                                <span x-text="dummyWeights.act.toFixed(2)"
                                    class="font-mono font-bold text-amber-600"></span>
                            </div>
                            <input type="range" min="0" max="1" step="0.01" x-model.number="dummyWeights.act"
                                @input="adjustDummyWeights('act')" :disabled="locked.act"
                                class="w-full h-2 bg-amber-200 rounded-lg appearance-none cursor-pointer hover:bg-amber-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        </div>
                    </div>

                    <template x-if="dummyError">
                        <div class="mt-4 p-4 bg-red-50 text-red-600 rounded-xl border border-red-100 text-sm font-medium"
                            x-text="dummyError"></div>
                    </template>
                </div>

                <!-- Ïò§Î•∏Ï™Ω: Í≤∞Í≥º ÌëúÏãú Ìå®ÎÑê -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm h-fit">
                    <h4 class="font-bold text-base text-slate-800 mb-4">üìä ÏãúÎÆ¨Î†àÏù¥ÏÖò Í≤∞Í≥º</h4>

                    <template x-if="dummyResult">
                        <div class="animate-fade-in-up">
                            <div class="text-center mb-6">
                                <div class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-2">
                                    Total Match Score</div>
                                <div class="text-6xl font-black text-indigo-600 mb-4" x-text="dummyResult.match_score">
                                </div>
                                <p class="text-sm text-slate-500" x-show="dummyResult.match_score >= 80">‚ú®
                                    ÏïÑÏ£º Ï¢ãÏùÄ Í∂ÅÌï©ÏûÖÎãàÎã§!</p>
                                <p class="text-sm text-slate-500"
                                    x-show="dummyResult.match_score < 80 && dummyResult.match_score >= 50">
                                    üëå Î¨¥ÎÇúÌïú Í¥ÄÍ≥ÑÏûÖÎãàÎã§.</p>
                                <p class="text-sm text-slate-500" x-show="dummyResult.match_score < 50">‚ö†Ô∏è
                                    ÎÖ∏Î†•Ïù¥ ÌïÑÏöîÌïú Í¥ÄÍ≥ÑÏûÖÎãàÎã§.</p>
                            </div>

                            <div class="grid grid-cols-3 gap-3 text-center mb-6">
                                <div class="bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                                    <div class="font-bold text-indigo-600 text-xl"
                                        x-text="dummyResult.details ? (dummyResult.details.similarity_score * 100).toFixed(0) : '-'">
                                    </div>
                                    <div class="text-[10px] text-slate-500 font-bold uppercase mt-1">
                                        Similarity</div>
                                </div>
                                <div class="bg-rose-50 p-3 rounded-xl border border-rose-100">
                                    <div class="font-bold text-rose-600 text-xl"
                                        x-text="dummyResult.details ? (dummyResult.details.chemistry_score * 100).toFixed(0) : '-'">
                                    </div>
                                    <div class="text-[10px] text-slate-500 font-bold uppercase mt-1">
                                        Chemistry</div>
                                </div>
                                <div class="bg-amber-50 p-3 rounded-xl border border-amber-100">
                                    <div class="font-bold text-amber-600 text-xl"
                                        x-text="dummyResult.details ? (dummyResult.details.activity_score * 100).toFixed(0) : '-'">
                                    </div>
                                    <div class="text-[10px] text-slate-500 font-bold uppercase mt-1">
                                        Activity</div>
                                </div>
                            </div>

                            <div class="text-xs text-slate-400 text-center">
                                * Í∞ÄÏ§ëÏπò Ï°∞Ï†ï Ïãú Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§.
                            </div>
                        </div>
                    </template>
                    <template x-if="!dummyResult && !loading">
                        <div class="flex flex-col items-center justify-center py-12 text-slate-400">
                            <div class="text-4xl mb-2">‚åõ</div>
                            <p class="text-sm">ÏÇ¨Ïö©Ïûê 2Î™ÖÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Í≤∞Í≥ºÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.</p>
                        </div>
                    </template>
                    <template x-if="loading">
                        <div class="flex flex-col items-center justify-center py-12 text-indigo-500">
                            <div class="text-4xl mb-2 animate-spin">üåÄ</div>
                            <p class="text-sm font-bold">Í≥ÑÏÇ∞ Ï§ë...</p>
                        </div>
                    </template>
                </div>
            </div>
        </div>


        <!-- 2. ÏÇ¨Ïö©Ïûê Î™©Î°ù (Middle) -->
        <div class="glass-panel p-6 rounded-2xl border border-slate-100">
            <div class="flex flex-col h-[500px]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-slate-800">üìã ÏÇ¨Ïö©Ïûê Î™©Î°ù (ÏÑ†ÌÉù)</h3>
                    <div class="flex items-center gap-2">
                        <input type="text" x-model="searchQuery" @input="onSearchInput" placeholder="Ïù¥Î¶Ñ/ID Í≤ÄÏÉâ..."
                            class="text-sm px-3 py-1.5 rounded-lg border border-slate-300 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 w-64">
                        <span class="text-xs text-slate-500" x-text="candidates.length + 'Î™Ö'"></span>
                    </div>
                </div>

                <div class="bg-slate-900 rounded-xl p-3 flex-1 overflow-y-auto custom-scrollbar">
                    <template x-if="candidates.length === 0">
                        <div class="text-center text-slate-500 py-20">
                            <span class="text-4xl block mb-2">üîç</span>
                            <span x-text="loading ? 'Î°úÎî© Ï§ë...' : 'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§'"></span>
                        </div>
                    </template>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <template x-for="user in candidates" :key="user.user_id">
                            <div class="bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors border border-transparent cursor-pointer group relative overflow-hidden"
                                :class="selectedIds.includes(user.user_id) ? 'border-indigo-500 ring-1 ring-indigo-500 bg-slate-700' : ''"
                                @click="toggleSelect(user.user_id)">

                                <!-- ÏÑ†ÌÉù ÌëúÏãú Î∞∞ÏßÄ -->
                                <div class="absolute top-0 right-0 p-2" x-show="selectedIds.includes(user.user_id)">
                                    <span
                                        class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shadow-sm"
                                        :class="selectedIds.indexOf(user.user_id) === 0 ? 'bg-indigo-600 text-white' : 'bg-indigo-600 text-white'">
                                        <span x-text="selectedIds.indexOf(user.user_id) === 0 ? 'A' : 'B'"></span>
                                    </span>
                                </div>

                                <div class="p-3 flex items-center gap-3">
                                    <div
                                        class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-600 flex items-center justify-center text-sm font-bold text-slate-300 group-hover:bg-slate-500 transition-colors">
                                        <span x-text="user.username.charAt(0).toUpperCase()"></span>
                                    </div>
                                    <div class="min-w-0 flex-1">
                                        <div class="flex items-center gap-2">
                                            <span class="text-white font-medium text-sm truncate"
                                                x-text="user.nickname || user.username"></span>
                                            <span x-show="user.is_dummy"
                                                class="px-1.5 py-0.5 rounded text-[10px] bg-indigo-900 text-indigo-200 border border-indigo-700">Dummy</span>
                                        </div>
                                        <div class="text-slate-400 text-xs truncate" x-text="user.email">
                                        </div>
                                        <div class="text-slate-500 text-[10px] mt-1">ID: <span
                                                x-text="user.user_id"></span></div>
                                    </div>

                                    <!-- ÎçîÎØ∏ ÏÇ≠Ï†ú Î≤ÑÌäº -->
                                    <button x-show="user.is_dummy" @click.stop="deleteDummy(user.user_id)"
                                        class="text-slate-600 hover:text-red-400 p-2 rounded transition-colors z-10"
                                        title="ÎçîÎØ∏ ÏÇ≠Ï†ú">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>


        <!-- 3. ÎçîÎØ∏ ÏÉùÏÑ± (Bottom) -->
        <div class="glass-panel p-6 rounded-2xl border border-indigo-100">
            <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                üìù ÎçîÎØ∏ ÏÇ¨Ïö©Ïûê ÏÉùÏÑ±
                <span class="text-xs font-normal text-slate-500">(ÌÖåÏä§Ìä∏Ïö© Í∞ÄÏÉÅ Îç∞Ïù¥ÌÑ∞)</span>
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Column: Manual Creation -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-indigo-100 text-indigo-700 p-1.5 rounded-lg text-lg">‚úçÔ∏è</span>
                        <h4 class="font-bold text-slate-700">ÏßÅÏ†ë ÏÉùÏÑ± (Manual)</h4>
                    </div>

                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">Ïù¥Î¶Ñ</label>
                            <input type="text" x-model="formData.name"
                                class="w-full rounded-lg border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 font-bold"
                                placeholder="ÏÉùÏÑ±Ìï† Ïù¥Î¶Ñ ÏûÖÎ†•">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">MBTI</label>
                                <select x-model="formData.mbti"
                                    class="w-full text-sm rounded-lg border-slate-300 focus:ring-indigo-500">
                                    <template x-for="type in mbtiTypes" :key="type">
                                        <option :value="type" x-text="type"></option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1">Socionics</label>
                                <select x-model="formData.socionics"
                                    class="w-full text-sm rounded-lg border-slate-300 focus:ring-indigo-500">
                                    <template x-for="type in socionicsTypes" :key="type">
                                        <option :value="type" x-text="type"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-2">Big5 ÏÑ±Í≤© (0-100)</label>
                            <div class="space-y-3 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <template x-for="(val, key) in formData.big5">
                                    <div class="flex items-center gap-3">
                                        <span class="text-[10px] font-bold text-slate-400 uppercase w-12"
                                            x-text="key.substring(0,4)"></span>
                                        <input type="range" min="0" max="100" x-model.number="formData.big5[key]"
                                            class="flex-1 h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                        <span class="text-xs w-6 text-right font-mono" x-text="val"></span>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-xs font-bold text-slate-500 mb-1">
                                <span>ÌôúÎèôÏÑ± (Line Count)</span>
                                <span class="text-indigo-600" x-text="formData.activity"></span>
                            </div>
                            <input type="range" min="50" max="3000" step="50" x-model.number="formData.activity"
                                class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <button @click="createDummy" :disabled="loading || !formData.name"
                            class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors disabled:opacity-50 shadow-md flex items-center justify-center gap-2 mt-2">
                            <span>üíæ</span> ÏÉùÏÑ±ÌïòÍ∏∞
                        </button>
                    </div>
                </div>

                <!-- Right Column: Quick Actions -->
                <div class="space-y-6">

                    <!-- Random Creation -->
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-purple-100 text-purple-700 p-1.5 rounded-lg text-lg">üé≤</span>
                            <h4 class="font-bold text-slate-700">ÎûúÎç§ ÏÉùÏÑ± (Random)</h4>
                        </div>
                        <div class="bg-purple-50 p-5 rounded-xl border border-purple-100 space-y-4">
                            <p class="text-xs text-purple-800 leading-relaxed">
                                Î¨¥ÏûëÏúÑ ÏÑ±Í≤©Í≥º ÌîÑÎ°úÌïÑÏùÑ Í∞ÄÏßÑ ÎçîÎØ∏ ÏÇ¨Ïö©ÏûêÎ•º Îπ†Î•¥Í≤å ÏÉùÏÑ±Ìï©ÎãàÎã§.
                            </p>
                            <div class="flex gap-2">
                                <input type="number" x-model.number="randomCount" min="1" max="50"
                                    class="w-20 rounded-xl border-purple-200 shadow-sm focus:border-purple-500 focus:ring-purple-500 text-center text-lg font-bold"
                                    placeholder="Qty">
                                <button @click="createRandomDummy" :disabled="loading"
                                    class="flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition-all shadow-md flex items-center justify-center gap-2">
                                    <span>‚ú®</span> ÎûúÎç§ ÏùºÍ¥Ñ ÏÉùÏÑ±
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Delete -->
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-red-100 text-red-700 p-1.5 rounded-lg text-lg">üóëÔ∏è</span>
                            <h4 class="font-bold text-slate-700">ÏùºÍ¥Ñ ÏÇ≠Ï†ú (Bulk Delete)</h4>
                        </div>
                        <div class="bg-red-50 p-5 rounded-xl border border-red-100 space-y-4">
                            <div class="flex gap-2">
                                <select x-model="bulkDeleteOrder"
                                    class="flex-1 text-sm font-bold text-slate-700 bg-white border border-red-200 rounded-xl focus:ring-red-500 py-3 pl-3">
                                    <option value="recent">ÏµúÍ∑º ÏÉùÏÑ±Ïàú</option>
                                    <option value="oldest">Ïò§ÎûòÎêú Ïàú</option>
                                </select>
                                <input type="number" x-model.number="bulkDeleteCount" min="1" max="100"
                                    class="w-20 rounded-xl border border-red-200 shadow-sm focus:ring-red-500 text-center text-lg font-bold py-2"
                                    placeholder="Qty">
                            </div>
                            <button @click="deleteBulkDummies" :disabled="loading"
                                class="w-full py-3 bg-white border-2 border-red-200 text-red-600 font-bold rounded-xl hover:bg-red-500 hover:text-white hover:border-red-500 transition-all shadow-sm flex items-center justify-center gap-2">
                                <span>üî•</span> ÏÇ≠Ï†ú Ïã§Ìñâ
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div> <!-- End Matching Tab Inner -->
</div>